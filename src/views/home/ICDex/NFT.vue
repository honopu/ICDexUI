<template>
  <div>
    <div class="nft-main container-width">
      <div class="w100" style="margin: 30px 0 20px; font-size: 16px">
        <a
          href="https://yuku.app/market/goncb-kqaaa-aaaap-aakpa-cai"
          target="_blank"
          rel="nofollow noreferrer noopener"
          class="link"
          >ICLighthouse Planet NFT</a
        >
      </div>
      <table>
        <thead>
          <tr align="left">
            <th>NFT</th>
            <th>Planet</th>
            <th>Number</th>
            <th style="width: 40%">Scenarios for use</th>
          </tr>
        </thead>
        <tbody>
          <tr align="left">
            <td>
              <div class="nft-img">
                <img
                  src="https://cdn.yumi.io/file/0.png?&url=https%3A%2F%2Fpgi7h-uqaaa-aaaao-ae6ha-cai.raw.ic0.app%2Ffile%2F0.png&width=800"
                  alt=""
                />
              </div>
            </td>
            <td>Neptune Card</td>
            <td>5</td>
            <td>
              <div><span class="dots"></span> Airdrop 3,000 ICL</div>
              <div><span class="dots"></span> Prioritize new features</div>
              <div><span class="dots"></span> Mining Acceleration</div>
              <div><span class="dots"></span> Create OAMMs at a discount</div>
              <div style="font-weight: bold" class="base-font-title">
                <span class="dots"></span> Can grant 5 vip-makers
              </div>
            </td>
          </tr>
          <tr align="left">
            <td>
              <div class="nft-img">
                <img
                  src="https://cdn.yumi.io/file/5.png?&url=https%3A%2F%2Fpgi7h-uqaaa-aaaao-ae6ha-cai.raw.ic0.app%2Ffile%2F5.png&width=800"
                  alt=""
                />
              </div>
            </td>
            <td>Uranus Card</td>
            <td>10</td>
            <td>
              <div><span class="dots"></span> Airdrop 3,000 ICL</div>
              <div><span class="dots"></span> Prioritize new features</div>
              <div><span class="dots"></span> Mining Acceleration</div>
              <div><span class="dots"></span> Create OAMMs at a discount</div>
              <div style="font-weight: bold" class="base-font-title">
                <span class="dots"></span> Listing referrer identity
              </div>
            </td>
          </tr>
          <tr align="left">
            <td>
              <div class="nft-img">
                <img
                  src="https://cdn.yumi.io/file/15.png?&url=https%3A%2F%2Fpgi7h-uqaaa-aaaao-ae6ha-cai.raw.ic0.app%2Ffile%2F15.png&width=800"
                  alt=""
                />
              </div>
            </td>
            <td>Saturn Card</td>
            <td>100</td>
            <td>
              <div><span class="dots"></span> Airdrop 2,500 ICL</div>
              <div><span class="dots"></span> Prioritize new features</div>
              <div><span class="dots"></span> Mining Acceleration</div>
              <div><span class="dots"></span> Create OAMMs at a discount</div>
            </td>
          </tr>
          <tr align="left">
            <td>
              <div class="nft-img">
                <img
                  src="https://cdn.yumi.io/file/126.png?&url=https%3A%2F%2Fpgi7h-uqaaa-aaaao-ae6ha-cai.raw.ic0.app%2Ffile%2F126.png&width=800"
                  alt=""
                />
              </div>
            </td>
            <td>Jupiter Card</td>
            <td>200</td>
            <td>
              <div><span class="dots"></span> Airdrop 2,100 ICL</div>
              <div><span class="dots"></span> Prioritize new features</div>
              <div><span class="dots"></span> Mining Acceleration</div>
              <div>
                <span class="dots"></span> Create private OAMMs at a discount
              </div>
            </td>
          </tr>
          <tr align="left">
            <td>
              <div class="nft-img">
                <img
                  src="https://cdn.yumi.io/file/346.png?&url=https%3A%2F%2Fpgi7h-uqaaa-aaaao-ae6ha-cai.raw.ic0.app%2Ffile%2F346.png&width=800"
                  alt=""
                />
              </div>
            </td>
            <td>Mars Card</td>
            <td>300</td>
            <td>
              <div><span class="dots"></span> Airdrop 1,800 ICL</div>
              <div><span class="dots"></span> Prioritize new features</div>
              <div><span class="dots"></span> Mining Acceleration</div>
              <div>
                <span class="dots"></span> Create private OAMMs at a discount
              </div>
            </td>
          </tr>
          <tr align="left">
            <td>
              <div class="nft-img">
                <img
                  src="https://cdn.yumi.io/file/870.png?&url=https%3A%2F%2Fpgi7h-uqaaa-aaaao-ae6ha-cai.raw.ic0.app%2Ffile%2F870.png&width=800"
                  alt=""
                />
              </div>
            </td>
            <td>Earth Card</td>
            <td>400</td>
            <td>
              <div><span class="dots"></span> Airdrop 1,500 ICL</div>
              <div><span class="dots"></span> Prioritize new features</div>
              <div><span class="dots"></span> Mining Acceleration</div>
              <div>
                <span class="dots"></span> Create private OAMMs at a discount
              </div>
            </td>
          </tr>
          <tr align="left">
            <td>
              <div class="nft-img">
                <img
                  src="https://cdn.yumi.io/file/1361.png?&url=https%3A%2F%2Fpgi7h-uqaaa-aaaao-ae6ha-cai.raw.ic0.app%2Ffile%2F1361.png&width=800"
                  alt=""
                />
              </div>
            </td>
            <td>Venus Card</td>
            <td>500</td>
            <td>
              <div><span class="dots"></span> Airdrop 1,200 ICL</div>
              <div><span class="dots"></span> Prioritize new features</div>
              <div><span class="dots"></span> Mining Acceleration</div>
              <div>
                <span class="dots"></span> Create private OAMMs at a discount
              </div>
            </td>
          </tr>
          <tr align="left">
            <td>
              <div class="nft-img">
                <img
                  src="https://cdn.yumi.io/file/1886.png?&url=https%3A%2F%2Fpgi7h-uqaaa-aaaao-ae6ha-cai.raw.ic0.app%2Ffile%2F1886.png&width=800"
                  alt=""
                />
              </div>
            </td>
            <td>Mercury Card</td>
            <td>507</td>
            <td>
              <div><span class="dots"></span> Airdrop 1,000 ICL</div>
              <div><span class="dots"></span> Prioritize new features</div>
              <div><span class="dots"></span> Mining Acceleration</div>
              <div>
                <span class="dots"></span> Create private OAMMs at a discount
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    <div v-if="getPrincipalId" class="container-width">
      <div class="base-color-w mt20" style="font-size: 16px">
        Your NFTs in wallet
      </div>
      <a-spin :spinning="nftSpinning">
        <div class="wallet-item-table wallet-item-table-nft">
          <ul class="nft-main">
            <li
              v-for="(ext, index) in tokensExt.slice(
                extPage * extPageNum,
                (extPage + 1) * extPageNum
              )"
              :key="index"
            >
              <div style="padding-top: 10px">
                <a
                  :href="`https://yuku.app/market/goncb-kqaaa-aaaap-aakpa-cai/${ext[0]}`"
                  rel="nofollow noreferrer noopener"
                  target="_blank"
                  ><img :src="getExtInfo(ext[2]).thumb" alt=""
                /></a>
              </div>
              <div class="ext-info">{{ getExtInfo(ext[2]).name }}</div>
              <div class="ext-transfer" @click="showTransferToken(ext[0])">
                <button type="button">Transfer</button>
              </div>
              <div class="ext-transfer" @click="depositToICDexRouter(ext[0])">
                <button type="button">Deposit to ICDexRouter</button>
              </div>
              <div
                v-show="
                  getExtInfo(ext[2]).name.toLocaleLowerCase() === 'uranus'
                "
                class="ext-transfer"
                @click="depositToDexAggregator(ext[0])"
              >
                <button type="button">Deposit to DexAggregator</button>
              </div>
            </li>
          </ul>
          <div class="no-nft-data" v-show="!nftSpinning && !tokensExt.length">
            You have no NFTs right now
          </div>
          <div class="nft-main-pagination">
            <a-pagination
              v-if="tokensExt.length > extPageNum"
              class="pagination"
              :defaultPageSize="extPageNum"
              :current="extPage + 1"
              :total="tokensExt.length"
              @change="pageChange"
            />
          </div>
        </div>
      </a-spin>
    </div>
    <div v-if="getPrincipalId" class="container-width">
      <div class="base-color-w mt20" style="font-size: 16px">
        Your NFTs in ICDexRouter
      </div>
      <a-spin :spinning="nftICDexRouterSpinning">
        <div class="wallet-item-table wallet-item-table-nft">
          <ul class="nft-main">
            <li
              v-for="(ext, index) in nftICDexRouter.slice(
                page * pageNum,
                (page + 1) * pageNum
              )"
              :key="index"
            >
              <div style="padding-top: 10px" class="nft-img">
                <img :src="getImg(ext[3])" alt="" />
              </div>
              <div class="ext-info">{{ Object.keys(ext[3])[0] }} CARD</div>
              <div class="ext-transfer" @click.stop="onWithdraw(ext)">
                Withdraw
              </div>
            </li>
          </ul>
          <div
            class="no-nft-data"
            v-show="!nftICDexRouterSpinning && !nftICDexRouter.length"
          >
            No Deposited NFT
          </div>
          <div class="nft-main-pagination">
            <a-pagination
              v-if="nftICDexRouter.length > pageNum"
              class="pagination"
              :defaultPageSize="pageNum"
              :current="page + 1"
              :total="nftICDexRouter.length"
              @change="pageChangeDeposited"
            />
          </div>
        </div>
      </a-spin>
    </div>
    <div v-if="getPrincipalId" class="container-width">
      <div class="base-color-w mt20" style="font-size: 16px">
        Your NFTs in DexAggregator
      </div>
      <a-spin :spinning="nftDexAggregatorSpinning">
        <div class="wallet-item-table wallet-item-table-nft">
          <ul class="nft-main">
            <li
              v-for="(ext, index) in nftDexAggregator.slice(
                pageDexAggregator * pageNumDexAggregator,
                (pageDexAggregator + 1) * pageNumDexAggregator
              )"
              :key="index"
            >
              <div class="nft-img">
                <img :src="getImg(ext[3])" alt="" />
              </div>
              <div class="ext-info">{{ Object.keys(ext[3])[0] }} CARD</div>
              <div
                class="ext-transfer"
                @click.stop="onWithdrawDexAggregator(ext)"
              >
                Withdraw
              </div>
            </li>
          </ul>
          <div
            class="no-nft-data"
            v-show="!nftDexAggregatorSpinning && !nftDexAggregator.length"
          >
            No Deposited NFT
          </div>
          <div class="nft-main-pagination">
            <a-pagination
              v-if="nftDexAggregator.length > pageNumDexAggregator"
              class="pagination"
              :defaultPageSize="pageNumDexAggregator"
              :current="pageDexAggregator + 1"
              :total="nftDexAggregator.length"
              @change="pageChangeDepositedDexAggregator"
            />
          </div>
        </div>
      </a-spin>
    </div>
    <a-modal
      v-model="visibleTransferNFT"
      centered
      title="Transfer NFT"
      width="550px"
      :footer="null"
      :keyboard="false"
      :maskClosable="false"
      class="manage-wallet-modal"
      :after-close="afterNftClose"
    >
      <div>
        <a-form-model
          ref="transferNFTForm"
          :model="transferNFTForm"
          :rules="transferNFTFormRules"
        >
          <a-form-model-item label="To" prop="to">
            <a-input
              v-model="transferNFTForm.to"
              autocomplete="off"
              placeholder="Principal Or Account Id"
            />
            <div class="base-font">
              Beware, not all wallets support all NFT.
            </div>
          </a-form-model-item>
          <a-form-model-item>
            <button
              type="button"
              class="transfer-submit large-primary primary mt20 w100"
              @click="transferNFT"
            >
              Transfer
            </button>
          </a-form-model-item>
        </a-form-model>
      </div>
    </a-modal>
  </div>
</template>

<script lang="ts">
import { Component, Vue } from 'vue-property-decorator';
import { Menu } from '@/components/menu/model';
import Launch from '@/views/home/ICDex/components/Launch.vue';
import AccountInfo from '@/views/home/components/AccountInfo.vue';
import { namespace } from 'vuex-class';
import { TokenInfo } from '@/ic/common/icType';
import {
  ApproveRequest,
  TokensExt,
  TransferNFTRequest,
  TransferNFTResponse,
  TransferNFTResponseErr,
  User
} from '@/ic/nft/model';
import {
  getTokenIdentifier,
  principalToAccountIdentifier
} from '@/ic/converter';
import {
  IC_DEX_ROUTER_CANISTER_ID,
  IC_SWAP_ROUTER_CANISTER_ID_Fiduciary,
  NFT_CANISTER_ID,
  validatePrincipal
} from '@/ic/utils';
import { validateCanisterOrAccount } from '@/utils/validate';
import { checkAuth } from '@/ic/CheckAuth';
import { isPlug } from '@/ic/isPlug';
import { isInfinity } from '@/ic/isInfinity';
import { Principal } from '@dfinity/principal';
import NFTIdl from '@/ic/nft/erc721.did';
import { NftService } from '@/ic/nft/Service';
import { ICDexRouterService } from '@/ic/ICDexRouter/ICDexRouterService';
import { NFT, NFTType } from '@/ic/ICDexRouter/model';
import { ICSwapRouterFiduciaryService } from '@/ic/ICSwapRouter/ICSwapRouterFiduciaryService';
import BigNumber from 'bignumber.js';
import { StakedNFT } from '@/ic/ICSwapRouter/model';

const commonModule = namespace('common');

@Component({
  name: 'NFT',
  components: { Launch, AccountInfo }
})
export default class extends Vue {
  @commonModule.Getter('getPrincipalId') getPrincipalId?: string;
  private tokens: { [key: string]: TokenInfo } = {};
  private nftSpinning = false;
  private nftICDexRouterSpinning = false;
  private tokensExt: TokensExt = [];
  private extPage = 0;
  private extPageNum = 20;
  private visibleTransferNFT = false;
  private NFTIndex: number;
  private NftService: NftService = null;
  private ICSwapRouterFiduciaryService: ICSwapRouterFiduciaryService = null;
  private nftDexAggregatorSpinning = false;
  private pageDexAggregator = 0;
  private pageNumDexAggregator = 5;
  private NFTStaked: Array<StakedNFT> = [];
  private NFTStakedPairs = 0;
  private lockedTime = '0';
  private nftDexAggregator: Array<NFT> = [];
  private ICDexRouterService: ICDexRouterService = null;
  private nftICDexRouter: Array<NFT> = [];
  private page = 0;
  private pageNum = 5;
  private transferNFTForm = {
    to: ''
  };
  private transferNFTFormRules = {
    to: [
      {
        required: true,
        message: 'Please enter principal or account id',
        trigger: 'blur'
      },
      { validator: validateCanisterOrAccount, trigger: 'blur' }
    ]
  };
  created(): void {
    this.NftService = new NftService();
    this.ICDexRouterService = new ICDexRouterService();
    this.ICSwapRouterFiduciaryService = new ICSwapRouterFiduciaryService();
    this.tokens = JSON.parse(localStorage.getItem('tokens')) || {};
    if (this.getPrincipalId) {
      this.getTokensExt();
      this.getTokensExtICDedRouter();
      this.getTokensExtDexAggregator();
      this.getNFTStaked();
    }
  }
  private async getNFTStaked(): Promise<void> {
    if (this.getPrincipalId) {
      const res = await this.ICSwapRouterFiduciaryService.NFTStaked(
        this.getPrincipalId
      );
      console.log(res);
      if (res && res.length) {
        this.NFTStaked = res;
        const now = new Date().getTime();
        this.lockedTime = new BigNumber(res[0][2].toString(10))
          .div(10 ** 6)
          .minus(now)
          .div(86400 * 1000)
          .decimalPlaces(0)
          .toString(10);
        this.NFTStakedPairs = new BigNumber(this.lockedTime)
          .div(30)
          .decimalPlaces(0)
          .toNumber();
      } else {
        this.NFTStaked = [];
      }
    } else {
      this.NFTStaked = [];
    }
  }
  private async getTokensExtDexAggregator(): Promise<void> {
    this.nftDexAggregator = await this.ICSwapRouterFiduciaryService.NFTBalance(
      this.getPrincipalId
    );
  }
  private async getTokensExtICDedRouter(): Promise<void> {
    const res = await this.ICDexRouterService.NFTBalance(this.getPrincipalId);
    console.log(res);
    this.nftICDexRouter = res;
  }
  private async getTokensExt(): Promise<void> {
    this.nftSpinning = true;
    try {
      const res = await this.NftService.tokens_ext();
      console.log(res);
      const tokensExt = (
        res as {
          ok: TokensExt;
        }
      ).ok;
      if (tokensExt && tokensExt.length) {
        this.tokensExt = tokensExt;
        console.log(tokensExt.length);
      } else {
        this.tokensExt = [];
      }
    } catch (e) {
      console.error(e);
    }
    this.nftSpinning = false;
  }
  private pageChangeDepositedDexAggregator(page: number): void {
    this.pageDexAggregator = page - 1;
  }
  private pageChangeDeposited(page: number): void {
    this.page = page - 1;
  }
  private pageChange(page: number): void {
    this.extPage = page - 1;
  }
  private onWithdrawDexAggregator(nft: NFT): void {
    console.log(nft[1]);
    const loading = this.$loading({
      lock: true,
      background: 'rgba(0, 0, 0, 0.5)'
    });
    let flag = false;
    this.NFTStaked.some((item) => {
      if (item[1] === nft[1]) {
        if (
          new BigNumber(item[2].toString(10))
            .div(10 ** 6)
            .gt(new Date().getTime())
        ) {
          flag = true;
        }
        return true;
      }
    });
    if (flag) {
      this.$message
        .warning(`Your NFT has sponsored ${this.NFTStakedPairs} trading pairs with a
            lockup period of ${this.lockedTime} days.`);
      loading.close();
      return;
    }
    // eslint-disable-next-line @typescript-eslint/no-this-alias
    const that = this;
    this.$confirm({
      content:
        'Withdrawing this NFT may disable the function it is linked to.',
      class: 'connect-plug',
      icon: 'connect-plug',
      centered: true,
      okText: 'Confirm',
      cancelText: 'Cancel',
      onOk() {
        that.ICSwapRouterFiduciaryService.NFTWithdraw([nft[1]])
          .then(() => {
            that.$message.success('Success');
            that.getTokensExt();
            that.getTokensExtDexAggregator();
          })
          .finally(() => {
            loading.close();
          });
      }
    });
  }
  private onWithdraw(nft: NFT): void {
    const type = Object.keys(nft[3])[0];
    // eslint-disable-next-line @typescript-eslint/no-this-alias
    const that = this;
    if (type === 'NEPTUNE') {
      this.$confirm({
        content: 'Withdrawing this NFT will unbind Makers.',
        class: 'connect-plug',
        icon: 'connect-plug',
        centered: true,
        okText: 'Confirm',
        cancelText: 'Cancel',
        onOk() {
          const loading = that.$loading({
            lock: true,
            background: 'rgba(0, 0, 0, 0.5)'
          });
          that.ICDexRouterService.NFTWithdraw([nft[1]])
            .then(() => {
              that.$message.success('Success');
              that.getTokensExt();
              that.getTokensExtICDedRouter();
            })
            .finally(() => {
              loading.close();
            });
        }
      });
    } else {
      this.$confirm({
        content:
          'Withdrawing this NFT may disable the function it is linked to.',
        class: 'connect-plug',
        icon: 'connect-plug',
        centered: true,
        okText: 'Confirm',
        cancelText: 'Cancel',
        onOk() {
          console.log(nft[1]);
          const loading = that.$loading({
            lock: true,
            background: 'rgba(0, 0, 0, 0.5)'
          });
          that.ICDexRouterService.NFTWithdraw([nft[1]])
            .then(() => {
              that.$message.success('Success');
              that.getTokensExt();
              that.getTokensExtICDedRouter();
            })
            .finally(() => {
              loading.close();
            });
        }
      });
    }
  }
  private async depositToDexAggregator(NFTIndex: bigint): Promise<void> {
    const spender = IC_SWAP_ROUTER_CANISTER_ID_Fiduciary;
    const token = getTokenIdentifier(NFT_CANISTER_ID, Number(NFTIndex));
    const approveRequest: ApproveRequest = {
      token: token,
      subaccount: [],
      allowance: BigInt(1),
      spender: Principal.fromText(spender)
    };
    await checkAuth();
    const loading = this.$loading({
      lock: true,
      background: 'rgba(0, 0, 0, 0.5)'
    });
    try {
      const res = await this.NftService.approve(approveRequest);
      if (res) {
        this.depositDexAggregator(loading, NFTIndex);
      } else {
        this.$message.error('Approve error');
        loading.close();
      }
    } catch (e) {
      this.$message.error('Approve error');
      console.error(e);
      loading.close();
    }
  }
  private async depositDexAggregator(loading, NFTIndex: bigint): Promise<void> {
    const res = await this.ICSwapRouterFiduciaryService.NFTDeposit(
      Principal.fromText(NFT_CANISTER_ID),
      getTokenIdentifier(NFT_CANISTER_ID, Number(NFTIndex))
    );
    loading.close();
    if (res) {
      this.extPage = 0;
      this.$message.success('Success');
      this.getTokensExt();
      this.getTokensExtDexAggregator();
    } else {
      this.$message.error('Error');
    }
  }
  private async depositToICDexRouter(NFTIndex: bigint): Promise<void> {
    const token = getTokenIdentifier(NFT_CANISTER_ID, Number(NFTIndex));
    const spender = IC_DEX_ROUTER_CANISTER_ID;
    const approveRequest: ApproveRequest = {
      token: token,
      subaccount: [],
      allowance: BigInt(1),
      spender: Principal.fromText(spender)
    };
    const loading = this.$loading({
      lock: true,
      background: 'rgba(0, 0, 0, 0.5)'
    });
    try {
      const res = await this.NftService.approve(approveRequest);
      if (res) {
        this.deposit(loading, NFTIndex);
      } else {
        this.$message.error('Approve error');
        loading.close();
      }
    } catch (e) {
      this.$message.error('Approve error');
      console.error(e);
      loading.close();
    }
  }
  private async deposit(loading, NFTIndex: bigint): Promise<void> {
    const res = await this.ICDexRouterService.NFTDeposit(
      Principal.fromText(NFT_CANISTER_ID),
      getTokenIdentifier(NFT_CANISTER_ID, Number(NFTIndex))
    );
    loading.close();
    if (res) {
      this.extPage = 0;
      this.$message.success('Success');
      this.getTokensExt();
      this.getTokensExtICDedRouter();
    } else {
      this.$message.error('Error');
    }
  }
  private showTransferToken(NFTIndex: bigint): void {
    this.NFTIndex = Number(NFTIndex);
    this.visibleTransferNFT = true;
    console.log(getTokenIdentifier(NFT_CANISTER_ID, this.NFTIndex));
  }
  private getExtInfo(val: Array<Array<number>>): any {
    if (val && val.length) {
      return JSON.parse(Buffer.from(val[0]).toString());
    }
    return {};
  }
  private afterNftClose(): void {
    (this.$refs.transferNFTForm as any).resetFields();
  }
  private async transferNFT(): Promise<void> {
    (this.$refs.transferNFTForm as any).validate(async (valid: any) => {
      if (valid) {
        await checkAuth();
        const loading = this.$loading({
          lock: true,
          background: 'rgba(0, 0, 0, 0.5)'
        });
        try {
          let to: User;
          let notify: boolean;
          if (validatePrincipal(this.transferNFTForm.to.trim())) {
            to = {
              principal: Principal.fromText(this.transferNFTForm.to.trim())
            };
            notify = true;
          } else {
            to = {
              address: this.transferNFTForm.to.trim()
            };
            notify = false;
          }
          const account = principalToAccountIdentifier(
            Principal.fromText(this.getPrincipalId)
          );
          const transferRequest: TransferNFTRequest = {
            from: {
              address: account
            },
            subaccount: [],
            to: to,
            token: getTokenIdentifier(NFT_CANISTER_ID, this.NFTIndex),
            memo: [],
            notify: notify,
            amount: BigInt(1)
          };
          if (isPlug()) {
            const transfer = {
              idl: NFTIdl,
              canisterId: NFT_CANISTER_ID,
              methodName: 'transfer',
              args: [transferRequest],
              onSuccess: async (res) => {
                this.transferNFTSuccess(res);
                loading.close();
              },
              onFail: () => {
                loading.close();
              }
            };
            const plugIc = (window as any).ic.plug;
            const res = await plugIc.batchTransactions([transfer]);
            console.log(res);
          } else if (isInfinity()) {
            const transfer = {
              idl: NFTIdl,
              canisterId: NFT_CANISTER_ID,
              methodName: 'transfer',
              args: [transferRequest],
              onSuccess: async (res) => {
                this.transferNFTSuccess(res);
                loading.close();
              },
              onFail: () => {
                loading.close();
              }
            };
            const Ic = (window as any).ic.infinityWallet;
            const res = await Ic.batchTransactions([transfer]);
            console.log(res);
          } else {
            const res = await this.NftService.transfer(transferRequest);
            this.transferNFTSuccess(res);
            loading.close();
          }
        } catch (e) {
          loading.close();
          console.error(e);
        }
      }
    });
  }
  private transferNFTSuccess(res: TransferNFTResponse): void {
    const response = Object.keys(res)[0];
    if (response === 'ok') {
      this.$message.success('Transfer NFT Success');
    } else {
      const err = (res as { err: TransferNFTResponseErr }).err;
      const errType = Object.keys(err)[0];
      if (errType === 'Other') {
        this.$message.error(
          (
            err as {
              Other: string;
            }
          ).Other
        );
      } else {
        this.$message.error(errType);
      }
    }
    this.visibleTransferNFT = false;
    this.getTokensExt();
  }
  private showLaunch(): void {
    (this.$refs.launch as any).init();
  }
  private getImg(nftType: NFTType): string {
    const type = Object.keys(nftType)[0];
    if (type === 'NEPTUNE') {
      return 'https://pgi7h-uqaaa-aaaao-ae6ha-cai.raw.ic0.app/file/1_thumb.jpeg';
    }
    if (type === 'URANUS') {
      return 'https://pgi7h-uqaaa-aaaao-ae6ha-cai.raw.ic0.app/file/5_thumb.jpeg';
    }
    if (type === 'SATURN') {
      return 'https://pgi7h-uqaaa-aaaao-ae6ha-cai.raw.ic0.app/file/15_thumb.jpeg';
    }
    if (type === 'JUPITER') {
      return 'https://pgi7h-uqaaa-aaaao-ae6ha-cai.raw.ic0.app/file/126_thumb.jpeg';
    }
    if (type === 'MARS') {
      return 'https://pgi7h-uqaaa-aaaao-ae6ha-cai.raw.ic0.app/file/346_thumb.jpeg';
    }
    if (type === 'EARTH') {
      return 'https://pgi7h-uqaaa-aaaao-ae6ha-cai.raw.ic0.app/file/870_thumb.jpeg';
    }
    if (type === 'VENUS') {
      return 'https://pgi7h-uqaaa-aaaao-ae6ha-cai.raw.ic0.app/file/1361_thumb.jpeg';
    }
    if (type === 'MERCURY') {
      return 'https://pgi7h-uqaaa-aaaao-ae6ha-cai.raw.ic0.app/file/1886_thumb.jpeg';
    }
  }
}
</script>

<style scoped lang="scss">
.home-header {
  top: 14px;
}
table {
  line-height: 1.5;
  td {
    padding-bottom: 10px;
  }
}
.wallet-item-table-nft {
  min-height: 40px;
  margin-top: 20px;
  background: #131920;
  padding: 5px 0;
}
.nft-main {
  display: flex;
  align-items: center;
  flex-wrap: wrap;
  margin-top: 10px;
  padding: 0 15px;
  color: #e7eaf1;
  li {
    width: 180px;
    margin: 0 15px 15px 0;
    border: 1px solid #313b46;
    &:nth-child(5n + 1) {
      margin-left: 0;
    }
    &:nth-child(5n) {
      margin-right: 0;
    }
    .ext-info {
      font-size: 12px;
      padding-top: 5px;
    }
    .ext-transfer {
      color: #1996c4;
      cursor: pointer;
      line-height: 1.2;
      button {
        width: 160px;
        height: 28px;
        padding: 6px;
        margin-bottom: 6px;
        margin-left: 10px;
      }
    }
    img {
      width: 160px;
      height: 160px;
      object-fit: contain;
    }
    div {
      text-align: center;
      line-height: 1.5;
    }
  }
}
.nft-main-pagination {
  display: flex;
  justify-content: flex-end;
  margin-top: 20px;
}
.no-nft-data {
  display: flex;
  align-items: center;
  justify-content: center;
  height: 30px;
  margin-top: 10px;
  color: #adb3c4;
}
.nft-img {
  img {
    width: 80px;
    height: 80px;
  }
}
.dots {
  display: inline-block;
  width: 6px;
  height: 6px;
  margin-bottom: 1px;
  border-radius: 3px;
  background: #adb3c4;
}

@media screen and (max-width: 768px) {
  .home-header {
    ul {
      display: none;
    }
  }
  .container-width {
    padding: 0 10px;
  }
}
</style>
